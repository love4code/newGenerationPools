<%- include('../../partials/admin-header') %> <% if (typeof success !==
'undefined' && success.length > 0) { %>
<div class="alert alert-success alert-dismissible fade show">
  <%= success[0] %>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<% } %> <% if (typeof error !== 'undefined' && error.length > 0) { %>
<div class="alert alert-danger alert-dismissible fade show">
  <%= error[0] %>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<% } %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Recent Contacts</h1>
</div>

<div class="card">
  <div class="card-body">
    <% if (contactMessages && contactMessages.length > 0) { %>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Town</th>
            <th>Service Type</th>
            <th>Message</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% contactMessages.forEach(contact => { %>
          <tr>
            <td><strong><%= contact.name %></strong></td>
            <td>
              <a href="mailto:<%= contact.email %>"><%= contact.email %></a>
            </td>
            <td>
              <% if (contact.phone) { %>
              <a href="tel:<%= contact.phone %>"><%= contact.phone %></a>
              <% } else { %>
              <span class="text-muted">-</span>
              <% } %>
            </td>
            <td><%= contact.town || '-' %></td>
            <td>
              <% if (contact.serviceType) { %>
              <span class="badge bg-info"><%= contact.serviceType %></span>
              <% } else { %>
              <span class="text-muted">-</span>
              <% } %>
            </td>
            <td>
              <% if (contact.message) { %>
              <span title="<%= contact.message %>">
                <%=
                  contact.message.length > 50
                    ? contact.message.substring(0, 50) + '...'
                    : contact.message
                %>
              </span>
              <% } else { %>
              <span class="text-muted">-</span>
              <% } %>
            </td>
            <td>
              <%= new Date(contact.createdAt).toLocaleDateString() %>
              <br />
              <small class="text-muted"
                ><%= new Date(contact.createdAt).toLocaleTimeString() %></small
              >
            </td>
            <td>
              <a
                href="/admin/contacts/<%= contact._id %>"
                class="btn btn-sm btn-outline-primary"
                >View</a
              >
              <form
                method="POST"
                action="/admin/contacts/<%= contact._id %>/delete"
                class="d-inline"
                onsubmit="return confirm('Are you sure you want to delete this contact message?');"
              >
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  Delete
                </button>
              </form>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
    <% } else { %>
    <div class="text-center text-muted py-5">
      <p>No contact messages found.</p>
    </div>
    <% } %>
  </div>
</div>

<%- include('../../partials/admin-footer') %>
