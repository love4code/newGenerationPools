<%- include('../../partials/admin-header') %> <% if (typeof success !==
'undefined' && success.length > 0) { %>
<div class="alert alert-success alert-dismissible fade show">
  <%= success[0] %>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<% } %> <% if (typeof error !== 'undefined' && error.length > 0) { %>
<div class="alert alert-danger alert-dismissible fade show">
  <%= error[0] %>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<% } %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1><%= customer.name %></h1>
  <div>
    <a
      href="/admin/customers/<%= customer._id %>/edit"
      class="btn btn-outline-primary"
      >Edit</a
    >
    <a
      href="/admin/customers/<%= customer._id %>/sales/new"
      class="btn btn-primary"
      >Create Sale</a
    >
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header">Customer Information</div>
      <div class="card-body">
        <p><strong>Name:</strong> <%= customer.name %></p>
        <% if (customer.email) { %>
        <p>
          <strong>Email:</strong>
          <a href="mailto:<%= customer.email %>"><%= customer.email %></a>
        </p>
        <% } %> <% if (customer.phone) { %>
        <p>
          <strong>Phone:</strong>
          <a href="tel:<%= customer.phone %>"><%= customer.phone %></a>
        </p>
        <% } %>
        <p>
          <strong>Status:</strong>
          <span
            class="badge bg-<%= customer.status === 'active' ? 'success' : 'secondary' %>"
          >
            <%= customer.status %>
          </span>
        </p>
        <% if (customer.address && (customer.address.street ||
        customer.address.city)) { %>
        <p>
          <strong>Address:</strong><br />
          <%= customer.address.street || '' %> <% if (customer.address.street &&
          customer.address.city) { %><br /><% } %> <%= customer.address.city ||
          '' %><% if (customer.address.city && customer.address.state) { %>, <%
          } %><%= customer.address.state || '' %> <%= customer.address.zip || ''
          %>
        </p>
        <% } %> <% if (customer.notes) { %>
        <p><strong>Notes:</strong><br /><%= customer.notes %></p>
        <% } %>
        <p class="text-muted small">
          <strong>Created:</strong> <%= new
          Date(customer.createdAt).toLocaleString() %><br />
          <strong>Updated:</strong> <%= new
          Date(customer.updatedAt).toLocaleString() %>
        </p>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header">Recent Sales</div>
      <div class="card-body">
        <% if (sales && sales.length > 0) { %>
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Date</th>
                <th>Status</th>
                <th>Total</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% sales.forEach(sale => { %>
              <tr>
                <td><%= new Date(sale.saleDate).toLocaleDateString() %></td>
                <td>
                  <span
                    class="badge bg-<%= sale.status === 'paid' ? 'success' : sale.status === 'cancelled' ? 'danger' : 'warning' %>"
                  >
                    <%= sale.status %>
                  </span>
                </td>
                <td>$<%= sale.total.toFixed(2) %></td>
                <td>
                  <a
                    href="/admin/sales/<%= sale._id %>"
                    class="btn btn-sm btn-outline-primary"
                    >View</a
                  >
                </td>
              </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
        <a
          href="/admin/sales?customerId=<%= customer._id %>"
          class="btn btn-sm btn-outline-primary"
          >View All Sales</a
        >
        <% } else { %>
        <p class="text-muted">No sales yet.</p>
        <% } %>
      </div>
    </div>
  </div>
</div>

<%- include('../../partials/admin-footer') %>
